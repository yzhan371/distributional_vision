<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

<style>
body {
	font-family: Arial, Helvetica;
    font-size: 14pt;
}

#introtext{
	text-align: left;
	margin: 0 auto;
	margin-top: 80px;
}

#exptitle{
	text-align: center;
}

#introButton{
	margin: 0 auto;
	border: 4px outset black;
	background: grey;
	width: 200px;
	text-align:center;
	display: none;
}

#startexp{
	text-decoration: none;
	text-align: center;
	color : black;
}

#startexp:hover{
	color : white;
}

.trial {
	border: 2px hidden grey;
	width: 400px;
	height: 400px;
	margin-left: auto;
	margin-right: auto;
	position: relative;
	display: none;
}

.trialimgg1{
	position:absolute;
	top: -4%;
	left: 0%;
}

.trialimgg2{
	position:absolute;
	top: -4%;
	left: 38%;
}

.trialimgg3{
	position:absolute;
	top: -4%;
	left: 70%;
}

.trialimgg4{
	position:absolute;
	top: 32%;
	left: 0%;
}

.trialimgg5{
	position:absolute;
	top: 32%;
	left: 38%;
}

.trialimgg6{
	position:absolute;
	top: 32%;
	left: 70%;
}

.trialimgg7{
	position:absolute;
	top: 69%;
	left: 0%;
}

.trialimgg8{
	position:absolute;
	top: 69%;
	left: 38%;
}

.trialimgg9{
	position:absolute;
	top: 69%;
	left: 70%;
}

.catchtrial {
	border: 2px hidden grey;
	width: 400px;
	height: 400px;
	margin-left: auto;
	margin-right: auto;
	position: relative;
	display: none;
}

.catchnote{
	position: absolute;
	top: 42%;
	left: 39%;
	border: 2px hidden grey;
	width: 100px;
	background-color: grey;
	text-align: center;
}

.fixation{
	height: 400px;
	width: 400px;
}

.slidercontainer {
  width: 25%;
  margin-left: auto;
  margin-right: auto;
  position: absolute;
  top: 63%;
  left: 37%;
  text-align: center;
  display: none;
}

.resizer {
  -webkit-appearance: none;
  width: 100%;
  height: 25px;
  background: #d3d3d3;
  outline: none;
  opacity: 0.7;
  -webkit-transition: .2s;
  transition: opacity .2s;
}

.resizer:hover {
  opacity: 1;
}

.resizer::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 25px;
  height: 25px;
  background: #af4c4c;
  cursor: pointer;
}

.resizer::-moz-range-thumb {
  width: 25px;
  height: 25px;
  background: #4CAF50;
  cursor: pointer;
}

#submitButton{
	display: none;
}

</style>

<div id="introtext" class="intro">
<h1 id="exptitle">Object Placing Experiment</h1>
<p>There are 81 trials in this experiment. In each trial, you will see an image of an object (for example, a vase) appear at a random location on the grey screen. After the image is presented to you, 
click on the grey map where you think the object would most likely appear in a common image. Use your intuition, there's no 'correct answer'. You can always reselect the position of the object by 
clicking on other positions on the grey map. If you were uncomfortable with the object size, you can resize the object using the slide bar under the grey map to any size that seemed suitable to you. </p>
<p>Among the normal trials, there are some 'irregular' trials. In these trials, instead of an image, a word instruction, will be presented to you. Then all you need to do is to click on the
 corresponding quadrant. For example, if it says, ‘top left’, you need to click anywhere on the top-left part of grey map and click the spacebar to confirm your selection and move 
 onto the next trial. </p>
<p>Each trial should take about 2-8 second and the entire task should take no more than 15 minutes to complete. Please try to complete this task without pausing and it's most ideal if you are in a
focusing environment. If you are comfortable with this task and you are ready to complete it without stopping, please click the START button below to start the task. </p>
<h2>Consent</h2>
<p>This task is completely anonymous. By completing this survey, you are consenting to be in this research study. Your participation is voluntary and you can stop at any time. If you are ready, check the box below to indicate your consent. When loading files is done, you can click the button to start.</p>
<p><input type="checkbox" name="consent_check" value="agree"> I agree to participate. </p>
</div>
<div id="introButton" class="intro">
<a href="#" id="startexp"> START </a>
</div>



<div id="catchtrial1" class="catchtrial">
<p><img src="https://raw.githubusercontent.com/yzhan371/distributional_vision/master/Behavioral%20Exp/images/fixation.jpg" class="fixation"> </p>
<div id="catchnote1" class = "catchnote">
<p>Top-left</p>
</div>
<input type="hidden" name="ctrial1RT" class="inputs" value="0" id="cRT1">
<input type="hidden" name="catch1x" class="inputs" value = "-1" id="cx1">
<input type="hidden" name="catch1y" class="inputs" value = "-1" id="cy1">
</div>

<div id="catchtrial2" class="catchtrial">
<p><img src="https://raw.githubusercontent.com/yzhan371/distributional_vision/master/Behavioral%20Exp/images/fixation.jpg" class="fixation"> </p>
<div id="catchnote2" class = "catchnote">
<p>Top-right</p>
</div>
<input type="hidden" name="ctrial2RT" class="inputs" value="0" id="cRT1">
<input type="hidden" name="catch2x" class="inputs" value = "-1" id="cx2">
<input type="hidden" name="catch2y" class="inputs" value = "-1" id="cy2">
</div>

<div id="catchtrial3" class="catchtrial">
<p><img src="https://raw.githubusercontent.com/yzhan371/distributional_vision/master/Behavioral%20Exp/images/fixation.jpg" class="fixation"> </p>
<div id="catchnote3" class = "catchnote">
<p>Bottom-left</p>
</div>
<input type="hidden" name="ctrial3RT" class="inputs" value="0" id="cRT1">
<input type="hidden" name="catch3x" class="inputs" value = "-1" id="cx3">
<input type="hidden" name="catch3y" class="inputs" value = "-1" id="cy3">
</div>

<div id="catchtrial4" class="catchtrial">
<p><img src="https://raw.githubusercontent.com/yzhan371/distributional_vision/master/Behavioral%20Exp/images/fixation.jpg" class="fixation"> </p>
<div id="catchnote4" class = "catchnote">
<p>Bottom-right</p>
</div>
<input type="hidden" name="ctrial4RT" class="inputs" value="0" id="cRT4">
<input type="hidden" name="catch4x" class="inputs" value = "-1" id="cx4">
<input type="hidden" name="catch4y" class="inputs" value = "-1" id="cy4">
</div>

<div id="catchtrial5" class="catchtrial">
<p><img src="https://raw.githubusercontent.com/yzhan371/distributional_vision/master/Behavioral%20Exp/images/fixation.jpg" class="fixation"> </p>
<div id="catchnote5" class = "catchnote">
<p>Top-left</p>
</div>
<input type="hidden" name="ctrial5RT" class="inputs" value="0" id="cRT5">
<input type="hidden" name="catch5x" class="inputs" value = "-1" id="cx5">
<input type="hidden" name="catch5y" class="inputs" value = "-1" id="cy5">
</div>

<div id="catchtrial6" class="catchtrial">
<p><img src="https://raw.githubusercontent.com/yzhan371/distributional_vision/master/Behavioral%20Exp/images/fixation.jpg" class="fixation"> </p>
<div id="catchnote6" class = "catchnote">
<p>Top-right</p>
</div>
<input type="hidden" name="ctrial6RT" class="inputs" value="0" id="cRT6">
<input type="hidden" name="catch6x" class="inputs" value = "-1" id="cx6">
<input type="hidden" name="catch6y" class="inputs" value = "-1" id="cy6">
</div>

<div id="catchtrial7" class="catchtrial">
<p><img src="https://raw.githubusercontent.com/yzhan371/distributional_vision/master/Behavioral%20Exp/images/fixation.jpg" class="fixation"> </p>
<div id="catchnote7" class = "catchnote">
<p>Bottom-left</p>
</div>
<input type="hidden" name="ctrial7RT" class="inputs" value="0" id="cRT7">
<input type="hidden" name="catch7x" class="inputs" value = "-1" id="cx7">
<input type="hidden" name="catch7y" class="inputs" value = "-1" id="cy7">
</div>

<div id="catchtrial8" class="catchtrial">
<p><img src="https://raw.githubusercontent.com/yzhan371/distributional_vision/master/Behavioral%20Exp/images/fixation.jpg" class="fixation"> </p>
<div id="catchnote8" class = "catchnote">
<p>Bottom-right</p>
</div>
<input type="hidden" name="ctrial8RT" class="inputs" value="0" id="cRT8">
<input type="hidden" name="catch8x" class="inputs" value = "-1" id="cx8">
<input type="hidden" name="catch8y" class="inputs" value = "-1" id="cy8">
</div>



<script>
var ntrial = 81;
var seq = [...Array(ntrial).keys()];
var trialOrder = shuffle(seq);
var curTrial = 0; 
var trialST;
var ncatch = 8;
var cseq = [...Array(ncatch).keys()];
var catchOrder = shuffle(cseq);
var curCatch = 0;
var itrial;
var imgseq = new Array();
var nameseq = ['airplane','armchair','bathtub','beacon','bed','bench','bicycle','blanket','boat','book','bookcase','bottle','bowl','building','bus','cabinet','candlestick','canister','car','chimney','cliff','cloud','computer','crosswalk','cup','desk','dishwasher','fan','figurine','fireplug','grass','hood','house','jar'
,'kettle','keyboard','knife','lamp','laptop','manhole','microwave','minibike','monitor','mountain','mouse','mug','napkin','notebook','ottoman','oven','pen','pillow','pitcher','plant','plate','printer','railing','refrigerator'
,'road','rock','rug','sand','sea','sidewalk','sink','soap','sofa','stool','streetlight','switch','swivel_chair','table','telephone','toaster','toilet','towel','tray','tree','truck','van','vase']
var cursize = 100;
var x = 0;
var y = 0;

function genTrials(){
	for (itrial=1; itrial<(ntrial+1);itrial++){
		imgseq[itrial-1]= Math.round(Math.random()*9);
		$('body').append(
			$('<div id="trial'+ itrial + '" class="trial"> <div id="trialimg'+ itrial+ '" class="trialimgg'+ (itrial%9+1) +'"> <p><img src="https://raw.githubusercontent.com/yzhan371/distributional_vision/master/Behavioral%20Exp/images/' + nameseq[itrial-1] +'00' + imgseq[itrial-1]+'.png" class="stimuli" width="100" height="100"> </p></div><p><img src="https://raw.githubusercontent.com/yzhan371/distributional_vision/master/Behavioral%20Exp/images/blank.png" class="fixation"> </p><input type="hidden" name="trial'+itrial+'RT" class="inputs" value="0" id="RT'+ itrial +'"><input type="hidden" name="trial' + itrial+ 'x" class="inputs" value = "-1" id="x'+ itrial+ '"><input type="hidden" name="trial'+ itrial+ 'y" class="inputs" value = "-1" id="y'+ itrial+ '"></div><div class = "slidercontainer" id="resizer'+ itrial+ '"><input type="range" min="50" max="300" value="100" class="resizer" name = "size'+itrial+'"><p>Press Spacebar to go on to the next trial.</p></div>')
		);
	}
	$('.inputs').appendTo('form');
	$('.resizer').appendTo('form');
}

function shuffle(o){
	for(var j, x, i = o.length; i; j = Math.floor(Math.random()*i), x=o[--i], o[i]=o[j],o[j]=x);
	return o;
}

function showTrial(numtrial){
	setTimeout(function() {
		$('#trial'+numtrial).show();
		setTimeout(function() {
			$('#trialimg'+numtrial).hide();
			$('#resizer'+numtrial).show()
			trialST = new Date(); 
			
			$(document).bind('keydown',function(event) {
				if (event.which ==32){
				$(document).unbind('keydown');
				endTrial();
				}
			})
		}, 1200);
	}, 1300);
}


function showCatch(numcatch){
	setTimeout(function() {
		$('#catchtrial'+numcatch).show();
		setTimeout(function() {
			$('#catchnote'+numcatch).hide();
			trialST = new Date(); 
			
			$(document).bind('keydown',function(event) {
				if (event.which ==32){
				$(document).unbind('keydown');
				endCatch();
				}
			})
		}, 1200);
	}, 1300);
}


function endCatch(){
	var curTime = new Date();
	var rt = curTime - trialST;
	$('#cRT'+(catchOrder[curCatch]+1)).val(rt);
	
	$('#catchtrial'+(catchOrder[curCatch]+1)).hide();
	
	curCatch++;
	showTrial((trialOrder[curTrial]+1));
}

function endTrial(){
	var curTime = new Date();
	var rt = curTime - trialST;
	$('#RT'+(trialOrder[curTrial]+1)).val(rt);
	
	$('#trial'+(trialOrder[curTrial]+1)).hide();
	$('#resizer'+(trialOrder[curTrial]+1)).hide();
	$('div').remove('#tag');
	cursize = 100;
	curTrial++;
	
	if (curTrial<ntrial){
		if ((curTrial+1)%9==1){
			showCatch(catchOrder[curCatch]+1);
		}else{
				showTrial((trialOrder[curTrial]+1));
		}
	}else{
		$('#submitButton').show();
	}
}



function showFirstTrial(){
	genTrials();
	showTrial((trialOrder[0])+1);
	$('.intro').hide();
}

$('#startexp').click(showFirstTrial);

$(document).ready(function(){ 

    $(document).on('click', '.trial', function (e) { 
		$('div').remove('#tag');
        $('.trial').append(            
            $('<div id="tag"> <p><img id="tagimg" src="https://raw.githubusercontent.com/yzhan371/distributional_vision/master/Behavioral%20Exp/images/'+nameseq[trialOrder[curTrial]]+ '00' + imgseq[trialOrder[curTrial]]+'.png" width="'+cursize+'" height="'+cursize+'"> </p></div>').css({
                position: 'absolute',
                top: e.pageY-cursize/2 + 'px',
                left: e.pageX-cursize/2-this.offsetLeft + 'px'
            })              
        );
		x = e.pageX-cursize/2-this.offsetLeft; 
		y = e.pageY-cursize/2;
		$('#x'+(trialOrder[curTrial]+1)).val(x);
		$('#y'+(trialOrder[curTrial]+1)).val(y);
    });

});



$('.catchtrial').ready(function(){ 

    $('.catchtrial').click(function (e) { 
		$('#tag').remove();
        $(this).append(            
            $('<div id="tag"></div>').css({
                position: 'absolute',
                top: e.pageY + 'px',
                left: e.pageX - this.offsetLeft + 'px',
				width: '10px',
				height: '10px',
				background: '#FF0000'
            })              
        );
		$('#cx'+(catchOrder[curCatch]+1)).val(e.pageX-this.offsetLeft);
		$('#cy'+(catchOrder[curCatch]+1)).val(e.pageY);
    });

});



$('input[name=consent_check]').change(function(){
	if($(this).is(':checked')){
		$('#introButton').show();
	} else {
		$('#introButton').hide();
	}
});

$(document).ready(function(){ 

    $(document).on('change', '.resizer', function () { 
		cursize = this.value;
		$('div').remove('#tag');
		$('.trial').append(            
            $('<div id="tag"> <p><img id="tagimg" src="https://raw.githubusercontent.com/yzhan371/distributional_vision/master/Behavioral%20Exp/images/'+nameseq[trialOrder[curTrial]]+ '00' + imgseq[trialOrder[curTrial]]+'.png" width="'+cursize+'" height="'+cursize+'"> </p></div>').css({
                position: 'absolute',
                top: y + 'px',
                left: x + 'px'
            })              
        );
    });

});


</script>

<input type="submit" id="submitButton">